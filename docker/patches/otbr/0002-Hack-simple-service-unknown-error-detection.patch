# ------------------------------ tabstop = 4 ----------------------------------
#
# If not stated otherwise in this file or this component's LICENSE file the
# following copyright and licenses apply:
#
# Copyright 2024 Comcast Cable Communications Management, LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# SPDX-License-Identifier: Apache-2.0
#
# ------------------------------ tabstop = 4 ----------------------------------

#
# Created by Kevin Funderburg on 09/11/2024
#

From efc8bdf4bd9fd2e531337c097ab8ca53c26a214e Mon Sep 17 00:00:00 2001
From: Christian Leithner <christian_leithner@comcast.com>
Date: Tue, 20 Feb 2024 14:17:07 -0600
Subject: [PATCH] Hack simple service unknown error detection

---
 src/dbus/client/client_error.cpp | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/src/dbus/client/client_error.cpp b/src/dbus/client/client_error.cpp
index 98535dddc4..28c1eb1b53 100644
--- a/src/dbus/client/client_error.cpp
+++ b/src/dbus/client/client_error.cpp
@@ -26,6 +26,8 @@
  *    POSSIBILITY OF SUCH DAMAGE.
  */

+#include <regex>
+
 #include "client_error.hpp"

 #include "common/code_utils.hpp"
@@ -74,10 +76,17 @@ static const std::pair<ClientError, const char *> sErrorNames[] = {
     {ClientError::OT_ERROR_REJECTED, OTBR_OPENTHREAD_ERROR_PREFIX ".Rejected"},
 };

+static std::regex unknown_service("The name .* was not provided by any \\.service files", std::regex_constants::ECMAScript);
+
 ClientError ConvertFromDBusErrorName(const std::string &aErrorName)
 {
     ClientError error = ClientError::ERROR_NONE;

+    if (std::regex_search(aErrorName, unknown_service))
+    {
+        return ClientError::ERROR_DBUS;
+    }
+
     for (const auto &p : sErrorNames)
     {
         if (p.second == aErrorName)
--
2.34.1

